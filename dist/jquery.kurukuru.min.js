/*! jQuery plugin kurukuru - v0.1.0 - 2013-04-04
* https://github.com/nak0yui/jquery.kurukuru.js
* Copyright (c) 2013 nak; Licensed MIT, GPL */
(function(e){"use strict";var t={debug:!1,width:480,height:327,defaultCurrent:3,pixelChange:8,loadingHtml:"<p>Now Loading...</p>",image:[],selectorZIndex:0,maskZIndex:1e3},n=function(e){var t=[];return t=t.concat.apply(t,e),t},r=function(e){e.preventDefault?e.preventDefault():e.stop(),e.returnValue=!1,e.stopPropagation()},i=function(e){var t,n=e.originalEvent;return n.targetTouches?t=n.targetTouches[0].pageX:t=e.pageX,t},s=function(t,n,r){var i={images:[],length:t.length,onLoaded:n,onProcessed:r,count:0,errorCount:0},s,o=function(){i.count++,e.isFunction(i.onProcessed)&&i.onProcessed.apply(i),i.count>=i.length&&e.isFunction(i.onLoaded)&&i.onLoaded.apply(i)},u=function(){o()},a=function(){i.errorCount++,o()};for(s=0;s<i.length;s++){var f=e("<img>");f.attr("src",t[s]),f.load(u),f.error(a),i.images.push(f)}return i};e.preLoadImage=function(e,t,n){return s(e,t,n)};var o=function(n,s){var o={},u=e.extend(!0,t,s),a=e(n),f,l=u.defaultCurrent,c=!1,h=-1,p=-1,d=!1,v={init:function(){var t={width:u.width,height:u.height};a.css(t).css({position:"relative",zIndex:u.selectorZIndex}),f=e('<div class="mask"></div>').css(t).css({backgroundColor:"white",filter:"alpha(opacity=0)",opacity:0,position:"absolute",zIndex:u.maskZIndex}),y(),a.append(e(u.loadingHtml).addClass("loading").css({zIndex:u.maskZIndex+1})),a.append(f),m(u.images)},update:function(t,n){return d===!1?!1:(typeof n!="undefined"?(e.extend(!0,u,n),o.destroy(),o.init()):(f.hide(),o.cleanupOnlyNotCurrentImage(),m(t),o.cleanupOnlyCurrentImage(),f.show()),!0)},cleanupOnlyNotCurrentImage:function(){a.children("img").filter(function(e){return e!==l}).remove()},cleanupOnlyCurrentImage:function(){a.children("img:first").remove()},cleanup:function(){a.children("img").remove()},destroy:function(){a.html("")}},m=function(t){g(),d=!1,e.preLoadImage(t,function(){c=this.images,e.each(c,function(e){this.css({position:"absolute",zIndex:u.selectorZIndex+1}),a.append(this),l!==e&&this.hide(),d=!0,f.unbind("mousedown"),f.unbind("touchstart"),f.bind("mousedown",b.mouseDown),f.bind("touchstart",b.mouseDown)}),y()})},g=function(){a.children(".loading").show()},y=function(){a.children(".loading").hide()},b={mouseDown:function(t){var n=i(t);r(t);if(!d)return;h=n,p=l,e(document).bind("mouseup",b.mouseUp),e(document).bind("mousemove",b.mouseMove),e(document).bind("touchmove",b.mouseMove),e(document).bind("touchend",b.mouseUp)},mouseUp:function(t){r(t),e(document).unbind("mouseup",b.mouseUp),e(document).unbind("mousemove",b.mouseMove),e(document).unbind("touchmove",b.mouseMove),e(document).unbind("touchend",b.mouseUp),p=-1},mouseMove:function(e){var t=i(e);if(!c[l])return;var n=t-h<0?-1:1,r=Math.abs(t-h),s=c.length,o=r/u.pixelChange;o=Math.floor(o%c.length),c[l].hide(),l=p+n*o;if(l>=s||l<0)l+=-1*n*s;c[l].show()}};return e.extend(o,v),o};e.fn.kurukuru=function(t){var n;return this.each(function(){n=o(this,t),n.init(),e(this).data("kurukuru",n)})}})(jQuery);